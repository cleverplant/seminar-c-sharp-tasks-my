creat cleverplant

Я надеюсь, что материал был полезен и Вы можете отблагодарить автора донатами.

**[Донаты.](https://yoomoney.ru/to/41001197327567)**

_______________________________________________________________________________________________________

**Я работал в редакторе VScode - не в IDE Visual Studio! Важно понимать разницу между редактором и средой программирования!** 

Все действия ниже актуальны для редактора. В интернете все авторы используют IDE Visual Studio 
и нифига нет примеров на редакторе VScode, потому что неудобно и тяжело использовать редактор 
для таких целей, несмотря на это, на этапе обучения, нужно использовать редактор для понимания 
того, как работает IDE.** 

**Затем, перейдя на IDE вы почувствуете нежный Дзен!**

________________________________________________________________________________________________________

*Подключаем библиотеку.* 

В этом проекте используется JSON ! 
JSON реализует возможность работы с Request - отправка запроса и Response - получение ответа на запрос.
Так мы получаем сведения от сервера погоды.

_________________________________________________________________________________________________________

Необходимо подключить библиотеку для работы с JSON: Newtonsof !
В VisualStudio это делается из прямо из самой IDE, но в VScode нужен бубен и терпение.

[_Библиотека Newtonsof :_](https://www.newtonsoft.com/json)

______________________________________________________________________________________________________________________

_вы можете увидеть ошибку в -> using Newtonsoft.Json.Linq;
для работы нужна библиотека Newtonsoft -> в powershell от имени администратора вводим -> 
Install-Package Newtonsoft.Json._ 

[в powershell получаем картинка:](https://github.com/cleverplant/seminar-c-sharp-tasks-my/blob/main/%D0%91%D0%B8%D0%B1%D0%BB%D0%B8%D0%BE%D1%82%D0%B5%D0%BA%D0%B0%20%D0%BF%D0%B0%D1%80%D1%81%D0%B8%D0%BD%D0%B3%20%D0%BF%D0%BE%20API/powershell.png)

______________________________________________________________________________________________________________________

_В VScode нужно внести изменения. в файле .csproj -> это сделает автоматически 

[_расширение NuGet Gallery :_](https://marketplace.visualstudio.com/items?itemName=patcx.vscode-nuget-gallery)

-> в палитре команд выбираем NuGet Gallery 
-> далее выбираем Newtonsoft.Json -> затем находим папку с нашим пректом -> инсталируем бибку
-> в файле .csproj будут изменения -> появится строка:  
<ItemGroup>
    <PackageReference Include="Newtonsoft.Json" Version="13.0.1" />
</ItemGroup>_

[в Newtonsoft.Json получаем картинка:](https://github.com/cleverplant/seminar-c-sharp-tasks-my/blob/main/%D0%91%D0%B8%D0%B1%D0%BB%D0%B8%D0%BE%D1%82%D0%B5%D0%BA%D0%B0%20%D0%BF%D0%B0%D1%80%D1%81%D0%B8%D0%BD%D0%B3%20%D0%BF%D0%BE%20API/NuGet%20Gallery.png)

______________________________________________________________________________________________________________________

_Ошибка в -> using Newtonsoft.Json.Linq; пропадет. Вожможно требуется перезапуск VScode._
____________________________________________________________________________________________________________________________________________


_____________________________________________________________________________________________________________________________________________

1. получить ключ на https://openweathermap.org/current#current_JSON

______________________________________________________________________________________________________________________________________________

2. из письма с ключом забираем тестовую строку:

 [api.openweathermap.org/data/2.5/weather?q=London,uk&APPID=0a9b051464990ec3facc0b5dba7c7c73](http://api.openweathermap.org/data/2.5/weather?q=London,uk&units=metric&APPID=0a9b051464990ec3facc0b5dba7c7c73)

 и через программу FIDDLER делаем запрос: вкладка composer -> Execute -> запрос выполнен

________________________________________________________________________________________________________________________________________________

3. смотрим результат запроса: во вкаладке inspectors -> что было отправлено и получено. 

в верхней части запрос - в нижней ответ от вебпортала. 

скопируем json-строку на вкаладке raw: 

{"coord":{"lon":-0.1257,"lat":51.5085},"weather":[{"id":803,"main":"Clouds","description":"broken clouds","icon":"04n"}],"base":"stations","main":{"temp":289.87,"feels_like":289.66,"temp_min":289.18,"temp_max":290.37,"pressure":1011,"humidity":79},"visibility":10000,"wind":{"speed":6.69,"deg":220},"clouds":{"all":75},"dt":1664937600,"sys":{"type":2,"id":2075535,"country":"GB","sunrise":1664950036,"sunset":1664991026},"timezone":3600,"id":2643743,"name":"London","cod":200}

_______________________________________________________________________________________________________________________________________________

4. можем изучить эту строку в просмоторщике формата json и из текста сформировать файл .json:

https://jsoneditoronline.org/

У меня - файл MyJson.json . Он даст представление о том в каком формате придет ответ от сервера. 
Затем мы из такого JSON ответа вытащим интересующие нас значения, для последующей работы в нашем проекте.

[как обращаться (выташить) значения, как обрабатывать JSON:](https://www.youtube.com/watch?v=T-xXWXeqc2M&t=40s)
________________________________________________________________________________________________________________________________________________

5. кодим и получаем погоду...просто устал писать... 
возможно позже опишу, что происходит в процессе отправки и получения запроса. 
Нет одного автора, который достоин внимания, а сформулировать, как в пректе работает Response и Response и написать от себя, нужна куча времени, поэтому чуть позже обязательно заполню этот фрейм!  

_________________________________________________________________________________________________________________________________________________

Ну а теперь я расскажу о файле [GetRequest.cs](https://github.com/cleverplant/seminar-c-sharp-tasks-my/blob/main/%D0%91%D0%B8%D0%B1%D0%BB%D0%B8%D0%BE%D1%82%D0%B5%D0%BA%D0%B0%20%D0%BF%D0%B0%D1%80%D1%81%D0%B8%D0%BD%D0%B3%20%D0%BF%D0%BE%20API/parsing%20weather%20C%23/GetRequest.cs), своими словами. 

[Вот принцип работы картинка](https://github.com/cleverplant/seminar-c-sharp-tasks-my/blob/main/%D0%91%D0%B8%D0%B1%D0%BB%D0%B8%D0%BE%D1%82%D0%B5%D0%BA%D0%B0%20%D0%BF%D0%B0%D1%80%D1%81%D0%B8%D0%BD%D0%B3%20%D0%BF%D0%BE%20API/response%20%26%20reques.png) _так можно представить, что делает Request - отправка запроса и Response - получение ответа на запрос.

Итак. Мы будем парсить сайт прогноза погоды https://openweathermap.org/. Парсинг эмулирует действия браузера с помощью кода своей программы. Мы, как и браузер, будем отправлять Get и Post запросы, но из кода своей программы.

Для парсинга нам понадобится ключ API. Регистрируемся и получаем письмо с ключом API key:
- Your API key is 0a9b051464990ec3facc0b5dba7c7c73
и примером строки для запроса: 
- api.openweathermap.org/data/2.5/weather?q=London,uk&units=metric&APPID=0a9b051464990ec3facc0b5dba7c7c73

[В программе Fiddler](https://www.telerik.com/fiddler) делаем запрос по этой строке во вкладке _composer_. После выполнения запроса смотрим, что было отправлено и получено во вкладке _inspector_. В вверхней части окна сам запрос, в нижней ответ от сервера погоды. Ответ будет в виде строки JSON. Копируем и вставляем в [редактор JSON](https://jsoneditoronline.org/) . Теперь переключателем мы меняем строковый формат JSON на формат для файла .json . После завершающего этапа написания программы мы сравним JSON из Fiddler = с тем [JSON](), который выдаст наша программа в консоли (терминале). 

Кодинг:

Для выполнения Get запроса создаем новый - public class GetRequest - [GetRequest.cs](https://github.com/cleverplant/seminar-c-sharp-tasks-my/blob/main/%D0%91%D0%B8%D0%B1%D0%BB%D0%B8%D0%BE%D1%82%D0%B5%D0%BA%D0%B0%20%D0%BF%D0%B0%D1%80%D1%81%D0%B8%D0%BD%D0%B3%20%D0%BF%D0%BE%20API/parsing%20weather%20C%23/GetRequest.cs).

Используя стандартную бибку  using System.Net; создадим объект запроса - _request в HttpWebRequest . 

Создадим конструктор класса в который передаем строку класса:

string address;
public GetRequest(string address)
        {
            _address = address;
        }

Создадим паблик метод Run. Этот метод в нужный момент запускает созданный запрос:
____________________________________________________________________________________________

public void Run()

        {

            _request = (HttpWebRequest)WebRequest.Create(_address);
            
            _request.Method = "Get";

        {

____________________________________________________________________________________________

создаем запрос:  _request = WebRequest.Create();  

и передаем ему адрес  _address:  _request = WebRequest.Create(_address);

Теперь приводим все к USDP WEBREQUEST = (HttpWebRequest)WebRequest.Create(_address); Так создали готовый запрос.

Следует указать, что данный запрос является Get запросом. Для этого укажем, что метод "Get" - .Method = "Get":

_request.Method = "Get";

_____________________________________________________________________________________________

Создадим объект ответа вебсервера: 

HttpWebResponse response = (HttpWebResponse)_request.GetResponse();
var stream = response.GetResponseStream();

____________________________________________________________________________________________

Создадим открытое (публичное) свойство (метод) respons:

public string Response { get; set; } в [GetRequest.cs]()

И в этот метод будем записыват ответ от вебсервера.

if (stream != null) Response = new StreamReader(stream).ReadToEnd();
 
При выполнении запроса могут быть ошибки. Запрос не всегда успешно доставлен. Для этого нужна конструкция try-catch:

try
            {
               

            }
            catch (Exception)
            {                
            }
____________________________________________________________________________________________
____________________________________________________________________________________________

Перейдем в class Program [Weather.cs](https://github.com/cleverplant/seminar-c-sharp-tasks-my/blob/main/%D0%91%D0%B8%D0%B1%D0%BB%D0%B8%D0%BE%D1%82%D0%B5%D0%BA%D0%B0%20%D0%BF%D0%B0%D1%80%D1%81%D0%B8%D0%BD%D0%B3%20%D0%BF%D0%BE%20API/parsing%20weather%20C%23/Weather.cs)

Здесь создаем запрос к веб порталу:

В созданную переменную var request нужно передать адрес нашеко вебсайта. 

var request = new GetRequest();

Скопируем его из письма. 

В виде строки для браузера будет: https://api.openweathermap.org/data/2.5/weather?q=London,uk&APPID=0a9b051464990ec3facc0b5dba7c7c73 

В эту строку я сразу добавил units=metric, чтобы перевести кельвины в градусы. 
 
var request = new GetRequest($"http://api.openweathermap.org/data/2.5/weather?q=London,uk&units=metric&APPID=0a9b051464990ec3facc0b5dba7c7c73");

Чтобы выполнить данный запрос, нужно у объекта request выполнить метод RUN: 

request.Run();

var request = new GetRequest($"http://api.openweathermap.org/data/2.5/weather?q=London,uk&units=metric&APPID=0a9b051464990ec3facc0b5dba7c7c73");
request.Run();
_______________________________________________________________________________________________

Запускаем программу - dot run - идем в программу Fiddler и видим ответ - это JSON код от веб портала. 

Так мы сделали запрос, но принять его некуда. Делаем вывод ответа от портала в переменную var response:

var response = request.Response;

Все. принимаем ответ.
______________________________________________________________________________________________

Теперь нам нужно отработать полученный результат. Нам нужен пакет Newtonsoft.Json. Мы его установили и можем представить строку JSON в вид JSON формат.  

Для этого создаем переменную в которую пишется парсинг:

var json = JObject.Parse(response); // преобразовываем строку в JSON формат

У нас будет объект, который парсит response - JObject.Parse(response)

Затем создадим переменные :

var name = json["name"];
var main = json["main"];
var wind = json["wind"];

выведем в консоль :

Console.WriteLine($"{name}{main}{wind}"); 

И результат в консоли будет похож на файл [MyJson.json](https://github.com/cleverplant/seminar-c-sharp-tasks-my/blob/main/%D0%91%D0%B8%D0%B1%D0%BB%D0%B8%D0%BE%D1%82%D0%B5%D0%BA%D0%B0%20%D0%BF%D0%B0%D1%80%D1%81%D0%B8%D0%BD%D0%B3%20%D0%BF%D0%BE%20API/parsing%20weather%20C%23/MyJson.json), потому что он все еще в JSON формате.

Можно на каждом этапе выполнять команду dot run и проверять работу программы и видеть ответ вебсервера в программе fiddler.

_Основное мы реализовали!_

Остается вытащить интересующие нас значения погоды из JSON и привести к понятному для человека виду. Как это сделать вы узнаете из коментов в самом файле [GetRequest.cs](https://github.com/cleverplant/seminar-c-sharp-tasks-my/blob/main/%D0%91%D0%B8%D0%B1%D0%BB%D0%B8%D0%BE%D1%82%D0%B5%D0%BA%D0%B0%20%D0%BF%D0%B0%D1%80%D1%81%D0%B8%D0%BD%D0%B3%20%D0%BF%D0%BE%20API/parsing%20weather%20C%23/GetRequest.cs)

А всего за 15 минут Вы узнаете и об этом, и о том, как работать c JSON из этого видео:

[JSON для начинающих](https://www.youtube.com/watch?v=T-xXWXeqc2M&t=40s)

В принципе простой шаблон для работы с API готов.

Желаю удачи! 

Отблагодарить автора донатами.

**[Донаты.](https://yoomoney.ru/to/41001197327567)**
_________________________________________________________________________________________________________________________________________________

Для чего это нужно знать о JSON ? 
Надеюсь, что теперь немного понятней ...

[Вот так выглядит то, что мы сделали картинка: ](https://github.com/cleverplant/seminar-c-sharp-tasks-my/blob/main/%D0%91%D0%B8%D0%B1%D0%BB%D0%B8%D0%BE%D1%82%D0%B5%D0%BA%D0%B0%20%D0%BF%D0%B0%D1%80%D1%81%D0%B8%D0%BD%D0%B3%20%D0%BF%D0%BE%20API/response%20%26%20reques.png)


[Вот такие виды API существуют картинка: ](https://github.com/cleverplant/seminar-c-sharp-tasks-my/blob/main/%D0%91%D0%B8%D0%B1%D0%BB%D0%B8%D0%BE%D1%82%D0%B5%D0%BA%D0%B0%20%D0%BF%D0%B0%D1%80%D1%81%D0%B8%D0%BD%D0%B3%20%D0%BF%D0%BE%20API/%D0%B2%D0%B8%D0%B4%D1%8B%20API.png)

____________________________________________________________________________________________________________________________________________________________
Материалы и средства используемые в проекте:

1. [Библиотека для работы с JSON](https://www.newtonsoft.com/json)

[в powershell получаем:](https://github.com/cleverplant/seminar-c-sharp-tasks-my/blob/main/%D0%91%D0%B8%D0%B1%D0%BB%D0%B8%D0%BE%D1%82%D0%B5%D0%BA%D0%B0%20%D0%BF%D0%B0%D1%80%D1%81%D0%B8%D0%BD%D0%B3%20%D0%BF%D0%BE%20API/Screenshot_1.png)


_у меня не получилось обойтись расширением NuGet Gallery и я устанавливал бибку через:  
в powershell от имени администратора вводим -> Install-Package Newtonsoft.Json_
____________________________________________________________________________________________________________________________________________________________

2. [Расширение NuGet Gallery в VScode для используемой библиотеки](https://marketplace.visualstudio.com/items?itemName=patcx.vscode-nuget-gallery)

_собственно по задумке оно должно инсталировать бибку в проект, но см.п.1_

[В нашем VSCode выбираем Newtonsoft.Json получаем:](https://github.com/cleverplant/seminar-c-sharp-tasks-my/blob/main/%D0%91%D0%B8%D0%B1%D0%BB%D0%B8%D0%BE%D1%82%D0%B5%D0%BA%D0%B0%20%D0%BF%D0%B0%D1%80%D1%81%D0%B8%D0%BD%D0%B3%20%D0%BF%D0%BE%20API/Screenshot_8.png)


__________________________________________________________________________________________________________________________________________________________

3. [Полный курс по JSON для начинающих](https://www.youtube.com/watch?v=T-xXWXeqc2M&t=40s)

_приходит понимание, что за фигню мы видим в ответе на запрос. как и какие способы обращения к данным в коллекции(массиве) 
JSON можно использовать_ 
_использовался в проекте_

_Дополнительно :_

4. [REST API - что это? Создаем API с нуля на Express](https://www.youtube.com/watch?v=lzQIhjElV_g) 

[OpenAPI и Swagger Editor - своё описание REST API с нуля](https://www.youtube.com/watch?v=hPzorok-gI4)

_не использовался в проекте, но полезно_

________________________________________________________________________________________________________________________________________________________

5. [Редактор JSON](https://jsoneditoronline.org/)

_можно легко из текста перевести в формат файла JSON . использовался в проекте для анализа получения прнимаемых данных_
________________________________________________________________________________________________________________________________________________________

6. [Валидатор JSON](https://jsonschemalint.com/)

 _не обязательно_
_очень интересная и полезная вещь. проверяет ограничения, свойства и нарушения в коде Json . О нем в видео о JSON есть_
_не использовался в проекте, но полезно_
________________________________________________________________________________________________________________________________________________________

7. [Проект SWAGGER](https://swagger.io/)

[OpenAPI и Swagger Editor - своё описание REST API с нуля](https://www.youtube.com/watch?v=hPzorok-gI4)


_очень полезный инструмент. Разработка API для каждого. 
Упростите разработку API для пользователей, команд и предприятий с помощью 
открытого и профессионального набора инструментов Swagger. 
Узнайте, как Swagger может помочь вам разрабатывать и документировать ваши API в любом масштабе. _
_не использовался в проекте, но полезно_

_в проекте не учавствовал, но будет в других )))_
_____________________________________________________________________________________________________________________________________________________


8. [Программа Fiddler](https://www.telerik.com/fiddler)

_широко использовалась в проекте для отправки, проверки и аналика запросов и ответов. очень полезная вещь_

  [возможности Fiddler](https://habr.com/ru/post/554562/)

_______________________________________________________________________________________________________________________________________________________

9. [Request и Response](https://www.youtube.com/watch?v=nJvch8qzkXk)
_в проекте этот ролик низкого качества, не принимал участия, но хоть дает представление что такое запросы и ответы_
_вообще это самая важная часть инфомации и я собирал ее из разных источников, но определенного автора я не могу представить, поэтому пользуйтесь гуголом пока, а если найду автора достойного внимания, то скину ссыль сюда_

[Знакомство с REST API и форматом JSON](https://www.youtube.com/watch?v=sUsTbcVGvMM&list=RDLVT-xXWXeqc2M&index=2)
_это хороший материал, он дает представление об API и также знакомит с популярным форматом данных JSON, без которого редко обходятся современные веб-приложения. В проекте не принимал участия, но будет в других )))_

_____________________________________________________________________________________________________________________________________________________

*_Вообще сущесвуют два вида парсинга: по API и без API._ 

_По API можно парсить по предоставленному API или создать свой API [с помощью инструмента SWAGGER](https://swagger.io/). Как раз об этом в видео [OpenAPI и Swagger Editor - своё описание REST API с нуля](https://www.youtube.com/watch?v=hPzorok-gI4)._*

[Вот так выглядит то, что мы сделали картинка: ](https://github.com/cleverplant/seminar-c-sharp-tasks-my/blob/main/%D0%91%D0%B8%D0%B1%D0%BB%D0%B8%D0%BE%D1%82%D0%B5%D0%BA%D0%B0%20%D0%BF%D0%B0%D1%80%D1%81%D0%B8%D0%BD%D0%B3%20%D0%BF%D0%BE%20API/response%20%26%20reques.png)

[Вот такие виды API существуют картинка: ](https://github.com/cleverplant/seminar-c-sharp-tasks-my/blob/main/%D0%91%D0%B8%D0%B1%D0%BB%D0%B8%D0%BE%D1%82%D0%B5%D0%BA%D0%B0%20%D0%BF%D0%B0%D1%80%D1%81%D0%B8%D0%BD%D0%B3%20%D0%BF%D0%BE%20API/%D0%B2%D0%B8%D0%B4%D1%8B%20API.png)

_____________________________________________________________________________________________________________________________________________________












